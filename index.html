<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>我的刷题 PWA</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
<header class="topbar">
  <div class="brand">
    <div class="logo">刷</div>
    <div class="titles">
      <div class="appname">我的刷题</div>
      <div class="subtitle" id="subtitle">（本地离线）</div>
    </div>
  </div>

  <div class="actions">
    <button class="btn ghost" id="btnTheme" title="切换日夜模式">🌙</button>
  </div>
</header>

<!-- ========== 设置页 ========== -->
<main id="page-setup" class="page">
  <section class="card">
    <h2>题库导入</h2>

    <div class="field">
      <label>导入题库（questions.json）</label>
      <input type="file" id="fileQuestions" accept=".json,application/json" />
      <div class="hint">首次使用需要导入一次。导入后数据保存在本机。</div>
    </div>

    <div class="field">
      <label>导入分类映射（category_map.json，可选）</label>
      <input type="file" id="fileCategoryMap" accept=".json,application/json" />
      <div class="hint">格式示例：{ "qid": "分类名", ... }（qid 与题库一致）</div>
    </div>

    <div class="row">
      <button class="btn" id="btnGoQuiz">进入刷题页</button>
      <button class="btn danger" id="btnResetLocal">清空本地数据</button>
    </div>
  </section>

  <section class="card">
    <h2>刷题设置</h2>

    <div class="grid2">
      <div class="field">
        <label>出题数量</label>
        <input type="number" id="inpCount" min="1" max="500" value="20" />
      </div>

      <div class="field">
        <label>题池模式</label>
        <select id="selPoolMode">
          <option value="all">随机（全题库）</option>
          <option value="wrong">只刷错题</option>
          <option value="unseen">只刷未做</option>
        </select>
      </div>
    </div>

    <div class="grid2">
      <div class="field">
        <label>学习方式</label>
        <select id="selStudyMode">
          <option value="timed">计时刷题（作答后可手动看解析）</option>
          <option value="review">复盘模式（作答后自动展开解析，不计时）</option>
        </select>
      </div>

      <div class="field">
        <label>分类（可选）</label>
        <select id="selCategory">
          <option value="">（全部）</option>
        </select>
      </div>
    </div>

    <div class="row">
      <button class="btn primary" id="btnStart">开始</button>
    </div>

    <div class="stats" id="statsBox"></div>

    <div class="row">
      <button class="btn" id="btnExportSession">导出本次记录</button>
      <button class="btn" id="btnExportAll">导出全部数据</button>
    </div>
  </section>
</main>

<!-- ========== 刷题页 ========== -->
<main id="page-quiz" class="page" style="display:none;">
  <section class="card">
    <div class="quiz-top">
      <div class="meta" id="metaLine">题号：—</div>
      <div class="rightmeta">
        <div class="progress" id="progressLine">进度：0/0</div>
        <div class="timer" id="timerText">00:00</div>
      </div>
    </div>

    <div class="quiz-controls">
      <button class="btn ghost" id="btnBackSetup">⚙ 返回设置</button>
      <button class="btn" id="btnDrawMode">🖊 题内画笔：关</button>
      <button class="btn" id="btnPen">✍️ 全屏笔</button>
      <button class="btn" id="btnClearDraw">清除痕迹</button>
      <button class="btn" id="btnToggleAnswer">显示/隐藏解析</button>
    </div>

    <!-- 提交后：总览圈圈 -->
    <div id="summaryBox" class="summary" style="display:none;"></div>

    <div id="questionWrapper" class="qwrap">
      <div id="stemText" class="stem">（题干）</div>
      <div id="optionsBox" class="opts"></div>
      <canvas id="drawCanvas" class="draw"></canvas>
    </div>

    <div id="explanationBox" class="result" style="display:none;"></div>

    <div class="field" id="noteArea" style="display:block;">
      <label>笔记（手动保存）</label>
      <textarea id="noteInput" rows="4" placeholder="写下错因/套路/关键词……"></textarea>
      <div class="row">
        <button class="btn" id="btnSaveNote">保存笔记</button>
        <button class="btn ghost" id="btnToggleNote">显示/隐藏笔记</button>
      </div>
    </div>

    <div class="row">
      <button class="btn" id="btnPrev">上一题</button>
      <button class="btn" id="btnNext">下一题</button>
      <button class="btn primary" id="btnFinish">提交并查看结果</button>
    </div>
  </section>
</main>

<!-- 全屏笔覆盖层 -->
<div id="inkOverlay" class="ink-overlay" style="display:none;">
  <button id="btnInkClose" class="ink-close" type="button">✕</button>
  <canvas id="inkCanvas" class="ink-canvas"></canvas>
</div>

<script src="app.js"></script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
  }
</script>
</body>
</html>
